# MusicSnap Backend Template
## Киселев Иван Александрович 

Данный репозиторий хранит шаблон проекта, который можно использовать в других.
Основной репозиторий ВКР:
https://github.com/ababism/musicsnap

### Описание сборки:
[BUILD_README.md](services/musicsnap/docs/BUILD_README.md)
### Описание конфигураций

[CONFIG.md](services/musicsnap/docs/CONFIG_README.md)

## Краткие достижения в написанном шаблоне проекта для любого бекенда
Созданные библиотеки:
- [querybuilder](pkg%2Fquerybuilder): Cоздание гибких SQL запросов для работы опциональными параметрами. Аналога не было в открытом доступе, поэтому библиотека создана самостоятельно 
- [app](pkg%2Fapp): Написанная самостоятельно библиотека для работы с ошибками в REST сервисе. Позволяет создавать вложенные ошибки и hhtp кодами, поддерживает вывод ошибок, скрывающий чувствительные данные от end user.
-  [msshutdown](pkg%2Fmsshutdown): graceful shutdown библиотека включающая в себя безопасное создание callback’а из любой точки приложение, детальную настройку тайм-аутов, возможность обработки ошибок и force shutdown
-  [config](pkg%2Fconfig): инструмент переписывающий yaml конфиги переменными из env, через рефлексию

Структура шаблона:
- [oapi](oapi) OpenAPI v3 спецификация API. Кодогенерация сервера, моделей запросов, обработчиков, функций проверки корректности данных по ней ([.codegen](.codegen), [musicsnap.gen.go](services%2Fmusicsnap%2Finternal%2Fhandler%2Fhttp%2Fmusicsnap%2Foapi%2Fmusicsnap.gen.go)).
- Написаны daemon, фоновые процедуры, с конфигурацией и поддержкой graceful отключения.
- Чистая архитектура и проработанный по best practice project layout

Наблюдаемость и инфраструктура:
- Трассировка c использованием Open telemetry и jaeger.
- Метрики Prometheus+Grafana показывающие нагрузку на ресурсы сервиса, метрики для мониторинга во время нагрузочного тестирования.

Инструменты и методологии сборки и конфигураций:
- [musicsnap.Dockerfile](musicsnap.Dockerfile): Docker multistage build методы сборки программы 
- [config](services%2Fmusicsnap%2Fconfig): Подробные настройки приложения с разными конфигами для сборки локально, в тестовом окружении и на сервере. А также .env файлы переписывающие yaml конфигурации.
- Docker compose файлы с для наблюдаемости и сервисов отдельно (поддержка масштабирования в случае ряда сервисов), все deployments и сервис могут работать независимо друг от друга ([deployments](deployments), [docker-compose.yml](docker-compose.yml)).

## Демонстрация работы систем и инструментов сервиса
https://drive.google.com/drive/folders/1Pkspd_EoJ0WwVXQSoeTVEMn5ONnwRzGX?usp=sharing

### Grafana и Метрики из Prometheus:
Здесь можно видеть нагрузку на процессоры и память сервиса.
Очень важные метрики для контроля нагрузки на сервис и его будущей оптимизации.
Выделение и очистка памяти в Go важный критерий для хорошей работы сервиса при высоких RPS.
![grafana.jpg](services%2Fmusicsnap%2Fimages%2Fgrafana.jpg)

### Трассировки с Jaeger и Open telemetry:
Тут можно видеть как работают спаны трассировки. 
Для каждого такого спана мы можем посмотреть в какой момент времени был вызван метод и сколько времени он занял.
Благодаря кодстайлу можно легко понимать что происходит в каждом спане, и как он идет по слоям.
![jaeger.jpg](services%2Fmusicsnap%2Fimages%2Fjaeger.jpg)

